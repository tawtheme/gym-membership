<ion-header translucent="true">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-button fill="clear" (click)="dismiss()">
                <ion-icon slot="icon-only" name="close"></ion-icon>
            </ion-button>
        </ion-buttons>
        <ion-title>Member Details</ion-title>
        <ion-buttons slot="end">
            <ion-button fill="clear" (click)="showActions()">
                <ion-icon slot="icon-only" name="ellipsis-vertical"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
    <div class="member-detail" *ngIf="member">
        <div class="detail-card">
            <div class="detail-avatar">
                {{ member.name ? member.name.charAt(0) : '?' }}
            </div>
            <div class="detail-main">
                <div class="detail-name">{{ member.name }}</div>
                <div class="detail-phone">Phone: {{ member.phone }}</div>
            </div>
        </div>

        <!-- Payment summary as its own card -->
        <div class="detail-card detail-card--payment">
            <div class="detail-payments-header">
                <h4>Payment Information</h4>
                <button type="button" class="update-payment-btn" (click)="updatePayment()">
                    <span class="material-icons">add</span>
                    Update Payment
                </button>
            </div>
            <div class="detail-payments">
                <div class="detail-progress" *ngIf="hasDates">
                    <div class="progress-header">
                        <div class="progress-label">
                            {{ daysLeft }} days left
                        </div>
                        <div class="progress-range">
                            {{ member.startDate | date: 'MMM d' }} â€“ {{ member.endDate | date: 'MMM d' }}
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div
                            class="progress-fill"
                            [style.width.%]="usedPercent"
                        ></div>
                    </div>
                    <div class="progress-caption" *ngIf="isExpired">
                        Membership has expired. Consider renewing this member.
                    </div>
                </div>
                <div class="detail-payments-row">
                    <span class="label">Payment Mode</span>
                    <span class="value" *ngIf="member.lastPaymentDate; else noLast">
                        {{ member.membershipType | titlecase }}
                    </span>
                    <ng-template #noLast>
                        <span class="value muted">Not recorded</span>
                    </ng-template>
                </div>
                <div class="detail-payments-row">
                    <span class="label">Last payment</span>
                    <span class="value" *ngIf="member.lastPaymentDate; else noLast">
                        {{ member.lastPaymentDate | date }}
                    </span>
                    <ng-template #noLast>
                        <span class="value muted">Not recorded</span>
                    </ng-template>
                </div>
            </div>
        </div>

        <!-- Payment Transactions Listing -->
        <app-payment-transactions
            *ngIf="transactions.length > 0"
            [transactions]="transactions"
            [memberName]="member.name"
        ></app-payment-transactions>

        <!-- Empty State for Transactions -->
        <app-no-data-found
            *ngIf="transactions.length === 0"
            icon="receipt_long"
            title="No Payment Transactions"
            message="No payment transactions found for this member">
        </app-no-data-found>
        
    </div>
</ion-content>