<ion-header translucent="true">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-button fill="clear" (click)="dismiss()">
                <ion-icon slot="icon-only" name="close"></ion-icon>
            </ion-button>
        </ion-buttons>
        <ion-title>Member Details</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
    <div class="member-detail" *ngIf="member">
        <div class="detail-card">
            <div class="detail-avatar">
                {{ member.name ? member.name.charAt(0) : '?' }}
            </div>
            <div class="detail-main">
                <div class="detail-name">{{ member.name }}</div>
                <div class="detail-phone">Phone: {{ member.phone }}</div>
            </div>
        </div>

        <!-- Payment summary as its own card -->
        <div class="detail-card detail-card--payment">
            <div class="detail-payments">
                <div class="detail-progress" *ngIf="hasDates">
                    <div class="progress-header">
                        <div class="progress-label">
                            {{ daysLeft }} days left
                        </div>
                        <div class="progress-range">
                            {{ member.startDate | date: 'MMM d' }} – {{ member.endDate | date: 'MMM d' }}
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div
                            class="progress-fill"
                            [style.width.%]="usedPercent"
                        ></div>
                    </div>
                    <div class="progress-caption" *ngIf="isExpired">
                        Membership has expired. Consider renewing this member.
                    </div>
                </div>
                <div class="detail-payments-row">
                    <span class="label">Payment Mode</span>
                    <span class="value" *ngIf="member.lastPaymentDate; else noLast">
                        {{ member.membershipType | titlecase }}
                    </span>
                    <ng-template #noLast>
                        <span class="value muted">Not recorded</span>
                    </ng-template>
                </div>
                <div class="detail-payments-row">
                    <span class="label">Last payment</span>
                    <span class="value" *ngIf="member.lastPaymentDate; else noLast">
                        {{ member.lastPaymentDate | date }}
                    </span>
                    <ng-template #noLast>
                        <span class="value muted">Not recorded</span>
                    </ng-template>
                </div>
            </div>
        </div>

        <!-- Payment Transactions Listing -->
        <div class="detail-card detail-card--transactions" *ngIf="transactions.length > 0">
            <div class="transactions-header">
                <div class="transactions-title">Payment Transactions</div>
                <div class="transactions-count">{{ transactions.length }}</div>
            </div>
            <div class="transactions-list">
                <div class="transaction-item" *ngFor="let transaction of transactions">
                    <div class="transaction-icon">
                        <span class="material-icons">{{ getPaymentModeIcon(transaction.paymentMode) }}</span>
                    </div>
                    <div class="transaction-details">
                        <div class="transaction-description">
                            {{ transaction.description || 'Membership Payment' }}
                        </div>
                        <div class="transaction-meta">
                            <span class="transaction-date">{{ transaction.paymentDate | date: 'MMM d, y' }}</span>
                            <span class="transaction-mode">{{ transaction.paymentMode | titlecase }}</span>
                        </div>
                    </div>
                    <div class="transaction-amount">
                        ₹{{ transaction.amount }}
                    </div>
                </div>
            </div>
        </div>

        <div class="detail-actions">
            <button type="button" class="action-button edit" (click)="edit()">
                Edit
            </button>
            <button type="button" class="action-button delete" (click)="dismiss()">
                Close
            </button>
        </div>
        
    </div>
</ion-content>